<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>관리자 페이지 - 국립경국대학교 디지털새싹</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="background"></div>
  <div class="header-wrapper">
    <div class="ci-bar">
      <img src="{{ url_for('static', filename='image/GKNU.png') }}" onclick="location.href='/'">
    </div>
    <div class="menu-bar">
      <div class="menu-item"><a href="/">메인</a></div>
      <div class="menu-item"><a href="/news">언론보도</a></div>
      <div class="menu-item"><a href="/imagepage">활동사진</a></div>
      <div class="menu-item"><a href="/notice">공지사항</a></div>
      <div class="menu-item"><a href="/support">강사지원</a></div>
      <div class="menu-item"><a href="/upload">게시물 작성</a></div>
      {% if session.get('user_id') %}
        {% if session.get('role') in ['admin', 'manager'] %}
        <div class="menu-item"><a href="/admin">관리자페이지</a></div>
        {% endif %}
        <div class="menu-item"><a href="/logout">로그아웃</a></div>
      {% else %}
        <div class="menu-item"><a href="/login">로그인</a></div>
        <div class="menu-item"><a href="/new_p">회원가입</a></div>
      {% endif %}
    </div>
  </div>

  <div class="admin-wrapper">
    <h2>📌 회원 목록</h2>
    <table>
      <tr>
        <th>이름</th>
        <th>아이디</th>
        <th>권한</th>
        <th>등급 설정</th>
        <th>관리</th>
      </tr>
      {% for user in users %}
      <tr>
        <td>{{ user.name }}</td>
        <td>{{ user.username }}</td>
        <td>{{ user.role }}</td>
        <td>
          {% if session.get('role') == 'admin' %}
            <a href="/set_role/{{ user.id }}/admin" class="btn">admin</a>
            <a href="/set_role/{{ user.id }}/manager" class="btn">manager</a>
            <a href="/set_role/{{ user.id }}/user" class="btn">user</a>
          {% else %}-{% endif %}
        </td>
        <td>
          {% if session.get('role') == 'admin' and user.id != session.get('user_id') %}
            <a href="/delete_user/{{ user.id }}" class="btn btn-danger" onclick="return confirm('정말 삭제하시겠습니까?');">삭제</a>
          {% else %}-{% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>

    <h2>📝 게시물 관리</h2>
    <table>
      <tr>
        <th>번호</th>
        <th>제목</th>
        <th>카테고리</th>
        <th>작성일</th>
        <th>승인여부</th>
        <th>관리</th>
      </tr>
      {% for post in posts %}
      <tr>
        <td>{{ post.id }}</td>
        <td>{{ post.title }}</td>
        <td>{{ post.category }}</td>
        <td>{{ post.date }}</td>
        <td>{{ '✅' if post.approved else '❌' }}</td>
        <td>
          {% if not post.approved and session.get('role') in ['admin', 'manager'] %}
          <a href="/approve_post/{{ post.id }}" class="btn">승인</a>
          {% endif %}
          <a href="/post/{{ post.id }}" class="btn">보기</a>
          {% if session.get('role') in ['admin', 'manager'] %}
          <a href="/delete/{{ post.id }}" class="btn btn-danger" onclick="return confirm('게시물을 삭제하시겠습니까?');">삭제</a>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
</body>
</html>
